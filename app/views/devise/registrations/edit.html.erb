<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
  <%= render "devise/shared/error_messages", resource: resource %>

  <div class="d-none d-md-block py-5">
    <h2 class="text-center jumbotron-underlayer__title py-3"><i data-feather="edit-3" class="feather-icon-style4"></i>&nbsp;&nbsp;プロフィール編集</h2>
  </div>
  <div class="d-sm d-md-none mb-0 pt-3">
    <h5 class="text-center jumbotron-underlayer__title my-0 py-3"><i data-feather="edit-3" class="feather-icon-style4"></i>&nbsp;&nbsp;プロフィール編集</h5>
  </div>

  <div class="container p-0 mt-4">
    <div class="col-md-8 offset-md-2 px-0">
      <div class="parent-tab">
        <ul class="nav nav-tabs parent-menu mt-0 pt-0">
          <li><a href="#tab_1" class="active mostleft-tab" data-toggle="tab">基本情報</a></li>
          <li><a href="#tab_2" data-toggle="tab">登録設定</a></li>
        </ul>
        <section class="parent-tab-content active mostleft-tab" id="tab_1">
          <div class="child-tab">
            <ul class="nav nav-tabs child-menu">
              <li><a href="#tab_1_1" data-toggle="tab">基礎情報</a></li>
              <li><a href="#tab_1_2" class="active" data-toggle="tab"><span class="text-warning">治療情報</span></a></li>
            </ul>
            <section class="child-tab-content px-1" id="tab_1_1">
              <div class="alert alert-secondary rounded-lg m-2 mb-3 small" role="alert">
                プロフィールを充実させましょう！
              </div>
              <table class="table mb-0">
                <tbody>
                  <tr>
                    <td class="profile-item-l small text-center px-0">アイコン</td>
                    <td class="profile-item-r">
                      <div class="img-field-parent">
                        <div id="img_field" onClick="$('#file').click()">
                          <% if @user.icon.attached? %>
                            <%= image_tag(@user.icon, class:"icon_image_edit") %>
                          <% else %>
                            <i class="fas fa-camera-retro fa-5x icon-camera"></i>
                          <% end %>
                        </div>
                        <small class="capacity-limit-attention"><small class="text-danger">※最大5MB</small></small>
                      </div><br>

                      <% if false %> deviseの中でどうやって削除paramsを取得するか？
                        <% if @user.icon.attached? %>
                          <div class="checkbox">
                            <label>
                              <input type="checkbox" name="user[user_icon]" value="off"><span class="small">アイコンを削除</span>
                            </label>
                          </div>
                        <% end %>
                      <% end %>

                      <p class="text-muted"><span class="text-primary filesize1"></span><span class="text-danger filesize2"></span></p>
                      <small class="text-muted">画像をクリックするとアイコン画像の選択ができます。</small>
                      <%= f.file_field :icon, class: "form-control", style: "display:none;", id: "file" %>
                    </td>
                  </tr>
                  <script>
                    $(function(){
                      $fileField = $('#file')

                      // 選択された画像を取得し表示
                      $($fileField).on('change', $fileField, function(e) {
                        file = e.target.files[0]
                        reader = new FileReader(),
                        $preview = $("#img_field");
                        var imgSize1 = this.files[0].size;
                        var imgSize = imgSize1 / 1000000
                        if(imgSize <= 5) {
                          $('span.filesize1').text("ファイルサイズ: " + imgSize.toFixed(2) + "MB").show();
                          $('span.filesize2').hide();
                        } else {
                          $('span.filesize2').text("ファイルサイズ: " + imgSize.toFixed(2) + "MB！  上限容量の5MBを超えています。").show();
                          $('span.filesize1').hide();
                        }

                        reader.onload = (function(file) {
                          return function(e) {
                            $preview.empty();
                            $preview.append($('<img>').attr({
                              src: e.target.result,
                              width: "100%",
                              class: "preview",
                              title: file.name
                            }));
                          };
                        })(file);
                        reader.readAsDataURL(file);
                      });
                    });
                  </script>
                  <tr>
                    <td class="small text-center px-0">名前</td>
                    <td><%= f.text_field :name, class: "form-control" %></td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">生年月</td>
                    <td>
                    <%= raw sprintf(
                      f.date_select(
                          :birthday,
                          use_month_numbers: true,
                          discard_day: true,
                          start_year:        (Time.now.year - 60),
                          end_year:          (Time.now.year - 18),
                          default:           Date.new(1980, 1, 1),
                          date_separator:    '%s'), # 年月日区切りをそれぞれ指定
                      '年 ') + '月'
                    %><br>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">リンク</td>
                    <td><%= f.text_field :link, class: "form-control", placeholder: "twitterやブログのURL" %></td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">自己紹介</td>
                    <td class="pl-0 pr-2"><%= f.text_area :self_introduction, class: "form-control border rounded-lg p-2", rows: "20", placeholder: "妊活から不妊治療へ至る経緯や、ご自身の細かい属性を盛り込みましょう！" %></td>
                  </tr>
                </tbody>
              </table>
              <div class="px-3 py-3">
                <%= f.submit "更新", class: "btn btn-raised btn-primary w-100" %>
              </div>
            </section>
            <section class="child-tab-content active px-1" id="tab_1_2">
              <div class="alert alert-info rounded-lg m-2 mb-3 small" role="alert">
                ぜひ以下項目にお答え下さい！<span class="small">(選択式)</span>
              </div>
              <table class="table mb-0">
                <tbody>
                  <tr>
                    <td class="small text-center px-0" style="width: 25%">妊活開始年齢</td>
                    <td style="width: 75%">
                      <%= f.select :first_age_to_start, User::HASH_AGE.invert, { prompt: "選択して下さい" }, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">妊活を始めた年齢</span>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">高度治療開始年齢</td>
                    <td>
                      <%= f.select :first_age_to_start_art, User::HASH_AGE.invert, { prompt: "選択して下さい" }, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">体外・顕微受精治療をスタートした年齢</span>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">人工授精回数</td>
                    <td>
                      <%= f.select :number_of_aih, User::HASH_AIH_COUNT.invert, { prompt: "選択して下さい" }, { class: "form-control" }  %>
                      <small class="text-muted">
                        <span class="small">体外・顕微受精治療をスタートする前に行った人工授精の回数</span>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">採卵回数</td>
                    <td>
                      <%= f.select :all_number_of_sairan, User::HASH_IVF_COUNT.invert, { prompt: "選択して下さい" }, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">特定のクリニックに限らず体外・顕微授精全体で行った全採卵回数</span>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">移植回数</td>
                    <td>
                      <%= f.select :all_number_of_transplants, User::HASH_IVF_COUNT.invert, { prompt: "選択して下さい" }, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">特定のクリニックに限らず体外・顕微授精全体で行った全移植回数</span>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">治療費</td>
                    <td>
                      <%= f.select :all_cost, User::HASH_ALL_COST.invert, { prompt: "選択して下さい" }, { class: "form-control" }  %>
                      <small class="text-muted">
                        <span class="small">特定のクリニックに限らず体外・顕微授精全体で行った全治療費用</span>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">化学流産経験</td>
                    <td>
                      <%= f.select :number_of_chemical_abortions, User::HASH_RYUZAN_COUNT.invert, { prompt: "選択して下さい" }, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">胎嚢確認前の流産</span>
                      </small>
                      <small id="poster-tip" class="form-text text-muted text-right mt-0"><%= f.check_box :number_of_chemical_abortions_status, {}, "hide", "show" %><span class="small">非公開</span></small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">初期流産経験</td>
                    <td>
                      <%= f.select :number_of_early_miscarriages, User::HASH_RYUZAN_COUNT.invert, { prompt: "選択して下さい" }, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">12w未満の流産</span>
                      </small>
                      <small id="poster-tip" class="form-text text-muted text-right mt-0"><%= f.check_box :number_of_early_miscarriages_status, {}, "hide", "show" %><span class="small">非公開</span></small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">後期流産経験</td>
                    <td>
                      <%= f.select :number_of_late_miscarriages, User::HASH_RYUZAN_COUNT.invert, { prompt: "選択して下さい" }, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">12w以降の流産</span>
                      </small>
                      <small id="poster-tip" class="form-text text-muted text-right mt-0"><%= f.check_box :number_of_late_miscarriages_status, {}, "hide", "show" %><span class="small">非公開</span></small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">助成金受給回数</td>
                    <td>
                      <%= f.select :number_of_times_the_grant_was_received, User::HASH_JOSEIKIN_COUNT.invert, { prompt: "選択して下さい" }, { class: "form-control" }  %>
                      <small class="text-muted">
                        <span class="small">全受給回数を選択して下さい</span>
                      </small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">助成金受給金額</td>
                    <td>
                      <%= f.select :all_grant_amount, User::HASH_JOSEIKIN.invert, {prompt: "選択して下さい"}, { class: "form-control" } %>
                      <small class="text-muted">
                        <span class="small">受給総額を選択して下さい</span>
                      </small>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="px-3 py-3">
                <%= f.submit "更新", class: "btn btn-raised btn-primary w-100" %>
              </div>
            </section>
          </div>
        </section>
        <section class="parent-tab-content" id="tab_2">
          <div class="child-tab">
            <ul class="nav nav-tabs child-menu">
              <li><a href="#tab_1_1" class="active" data-toggle="tab">設定情報</a></li>
            </ul>
            <section class="child-tab-content active px-1" id="tab_2_1">
              <div class="alert alert-secondary rounded-lg m-2 mb-3 small" role="alert">
                こちらからユーザー登録情報の変更ができます
              </div>
              <table class="table">
                <tbody>
                  <tr>
                    <td class="profile-item-l small text-center px-0">メールアドレス</td>
                    <td class="profile-item-r">
                      <%= f.text_field :email, autofocus: true, autocomplete: "email", class: "form-control" %>
                      <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
                        <div><%= resource.unconfirmed_email %>に届いた認証リンク確認することで更新が完了します</div>
                      <% end %>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">新パスワード</td>
                    <td>
                      <%= f.password_field :password, autocomplete: "new-password", class: "form-control" %>
                      <% if @minimum_password_length %>
                        <small><%= @minimum_password_length %> 文字以上で構成して下さい。変更しない場合は空白のまま更新して下さい</small>
                      <% end %>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">パスワード確認</td>
                    <td>
                      <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "form-control" %>
                      <small>上記と同じパスワードを入力してください</small>
                    </td>
                  </tr>
                  <tr>
                    <td class="small text-center px-0">性別</td>
                    <td>
                      <%= f.label :female, "女" %>
                      <%= f.radio_button :gender, :female, class: "mr-3" %>
                      <%= f.label :male, "男" %>
                      <%= f.radio_button :gender, :male %>
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="px-3 py-3">
                <%= f.submit "更新", class: "btn btn-raised btn-primary w-100" %>
              </div>
            </section>
          </div>
        </section>
      </>
    </div>
  </div>
<% end %>  


