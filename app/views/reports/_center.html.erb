<% if @reports.blank? %>
  <div class="pt-5 text-center">
    <p><%= image_tag"home/crying_face.svg", width: "30%", class: "m-0 p-0", loading: "lazy" %></p>
    <h2>該当するレポコはまだありません。</h2>
  </div>
<% end %>

<% @reports.each_with_index do |report, num| %>
  <div class="row main-column">
    <div class="col-12">
      <div class="row">
        <div class="col-3 px-0">
          <%= link_to user_path(report.user_id), data: { "turbolinks" => false } do %>
            <div class="icon-field py-0">
              <% if report.user.icon.present? %>
                <%= image_tag(report.user.icon, class:"icon_image") %>
              <% else %>
                <% user_number = report.user_id.digits %>
                <% if user_number.size < 2 %>
                  <% icon_number = report.user_id %>
                <% else %>
                  <% if user_number[1] == 0 %>
                    <% icon_number = user_number[0] * user_number[0] %>
                  <% else %>
                    <% icon_number = user_number[0] * user_number[1] %>
                  <% end %>
                <% end %>
                <% if report.treatment_end_age == nil %>
                  <div class="m-0 p-0 base_icon text-center">
                    <%= image_tag("icon/g_blank.png", alt: "generation_blank", class: "icon_image_border", loading: "lazy", title: "不明") %>
                    <%= image_tag("icon/#{icon_number}.svg", alt: "generation_blank", class: "icon_on_icon2", loading: "lazy", title: "不明") %>
                  </div>
                <% elsif report.treatment_end_age < 25 %>
                  <div class="m-0 p-0 base_icon text-center">
                    <%= image_tag("icon/g_10_24.png", alt: "generation10_24", class: "icon_image_border", loading: "lazy", title: "〜24歳") %>
                    <%= image_tag("icon/#{icon_number}.svg", alt: "generation10_24", class: "icon_on_icon2", loading: "lazy", title: "〜24歳") %>
                  </div>
                <% elsif report.treatment_end_age < 30 %>
                  <div class="m-0 p-0 base_icon text-center">
                    <%= image_tag("icon/g_25_29.png", alt: "generation25_29", class: "icon_image_border", loading: "lazy", title: "25〜29歳") %>
                    <%= image_tag("icon/#{icon_number}.svg", alt: "generation25_29", class: "icon_on_icon2", loading: "lazy", title: "25〜29歳") %>
                  </div>
                <% elsif report.treatment_end_age < 35 %>
                  <div class="m-0 p-0 base_icon text-center">
                    <%= image_tag("icon/g_30_34.png", alt: "generation30_34", class: "icon_image_border", loading: "lazy", title: "30〜34歳") %>
                    <%= image_tag("icon/#{icon_number}.svg", alt: "generation30_34", class: "icon_on_icon2", loading: "lazy", title: "30〜34歳") %>
                  </div>
                <% elsif report.treatment_end_age < 40 %>
                  <div class="m-0 p-0 base_icon text-center">
                    <%= image_tag("icon/g_35_39.png", alt: "generation35_39", class: "icon_image_border", loading: "lazy", title: "35〜39歳") %>
                    <%= image_tag("icon/#{icon_number}.svg", alt: "generation30_34", class: "icon_on_icon2", loading: "lazy", title: "35〜39歳") %>
                  </div>
                <% elsif report.treatment_end_age < 45 %>
                  <div class="m-0 p-0 base_icon text-center">
                    <%= image_tag("icon/g_40_44.png", alt: "generation40_44", class: "icon_image_border", loading: "lazy", title: "40〜44歳") %>
                    <%= image_tag("icon/#{icon_number}.svg", alt: "generation40_44", class: "icon_on_icon2", loading: "lazy", title: "40〜44歳") %>
                  </div>
                <% else %>
                  <div class="m-0 p-0 base_icon text-center">
                    <%= image_tag("icon/g_45_.png", alt: "generation45_", class: "icon_image_border", loading: "lazy", title: "45歳〜") %>
                    <%= image_tag("icon/#{icon_number}.svg", alt: "generation45_", class: "icon_on_icon2", loading: "lazy", title: "45歳〜") %>
                  </div>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
        <div class="col-9 pl-0">
          <%= link_to report, data: { "turbolinks" => false } do %>
            <div class="date mb-2 pt-0 px-0 d-flex justify-content-between">
              <small class="text-muted">
                <% unless report.current_state.blank? %>
                  <%= report.str_current_state %>
                <% end %>
              </small>
              <small class="text-muted">
                <%= report.created_at.to_s(:datetime_jp) %>
              </small>
            </div>
            <div class="d-flex align-items-center">
              <div>
                <h5 class="mb-0 mx-0 mb-1">
                  <%= report.clinic.name %>
                </h5>
              </div>
            </div>
            <div class="d-none d-sm-block mt-3">
              <p class="mb-0">
                <% if report.treatment_end_age == nil %>
                  <%= image_tag("icon/g_blank.png", alt: "generation_blank", width: "17px", class: "px-0", loading: "lazy", title: "不明") %>
                <% elsif report.treatment_end_age < 25 %>
                  <%= image_tag("icon/g_10_24.png", alt: "generation10_24", width: "17px", class: "px-0", loading: "lazy", title: "〜24歳") %>
                <% elsif report.treatment_end_age < 30 %>
                  <%= image_tag("icon/g_25_29.png", alt: "generation25_29", width: "17px", class: "px-0", loading: "lazy", title: "25〜29歳") %>
                <% elsif report.treatment_end_age < 35 %>
                  <%= image_tag("icon/g_30_34.png", alt: "generation30_34", width: "17px", class: "px-0", loading: "lazy", title: "30〜34歳") %>
                <% elsif report.treatment_end_age < 40 %>
                  <%= image_tag("icon/g_35_39.png", alt: "generation35_39", width: "17px", class: "px-0", loading: "lazy", title: "35〜39歳") %>
                <% elsif report.treatment_end_age < 45 %>
                  <%= image_tag("icon/g_40_44.png", alt: "generation40_44", width: "17px", class: "px-0", loading: "lazy", title: "40〜44歳") %>
                <% else %>
                  <%= image_tag("icon/g_45_.png", alt: "generation45_", width: "17px", class: "px-0", loading: "lazy", title: "45歳〜") %>
                <% end %>
                <%= strip_tags(report.user.name.to_s).gsub(/[\n]/,"").strip.truncate(12) %>&nbsp;&nbsp;<span class="small text-muted">さんのレポコ</span>
              </p>
            </div>
          <% end %>
        </div>
      </div>
      <div class="row">
        <div class="col-9 col-sm-10 px-0">
          <div class="d-block d-sm-none">
            <div class="pl-4">
              <div class="row">
                <div class="offset-sm-1">
                  <p class="mb-0">
                    <% if report.treatment_end_age == nil %>
                      <%= link_to image_tag("icon/g_blank.png", alt: "generation_blank", width: "17px", class: "px-0", loading: "lazy", title: "不明"), user_path(report.user_id) %>
                    <% elsif report.treatment_end_age < 25 %>
                      <%= link_to image_tag("icon/g_10_24.png", alt: "generation10_24", width: "17px", class: "px-0", loading: "lazy", title: "〜24歳"), user_path(report.user_id) %>
                    <% elsif report.treatment_end_age < 30 %>
                      <%= link_to image_tag("icon/g_25_29.png", alt: "generation25_29", width: "17px", class: "px-0", loading: "lazy", title: "25〜29歳"), user_path(report.user_id) %>
                    <% elsif report.treatment_end_age < 35 %>
                      <%= link_to image_tag("icon/g_30_34.png", alt: "generation30_34", width: "17px", class: "px-0", loading: "lazy", title: "30〜34歳"), user_path(report.user_id) %>
                    <% elsif report.treatment_end_age < 40 %>
                      <%= link_to image_tag("icon/g_35_39.png", alt: "generation35_39", width: "17px", class: "px-0", loading: "lazy", title: "35〜39歳"), user_path(report.user_id) %>
                    <% elsif report.treatment_end_age < 45 %>
                      <%= link_to image_tag("icon/g_40_44.png", alt: "generation40_44", width: "17px", class: "px-0", loading: "lazy", title: "40〜44歳"), user_path(report.user_id) %>
                    <% else %>
                      <%= link_to image_tag("icon/g_45_.png", alt: "generation45_", width: "17px", class: "px-0", loading: "lazy", title: "45歳〜"), user_path(report.user_id) %>
                    <% end %>
                    <%= link_to user_path(report.user_id), {class: "small"} do %>
                      <%= strip_tags(report.user.name.to_s).gsub(/[\n]/,"").strip.truncate(12) %>
                    <% end %>
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-2 pl-4">
            <div class="row">
              <div class="col-3 col-sm-2 offset-sm-1 d-flex align-items-center">
                <div class="likes_buttons_<%= report.id %>">
                  <%= render partial: 'likes/like_index', locals: { report: report, like_count: @like_count[report.id] } %>
                </div>
              </div>
              <div class="col-sm-9">
                <%= link_to report, data: { "turbolinks" => false } do %>
                  <div class="d-none d-sm-block lead-content px-2">
                    <% if report.content.present? %>
                      <small><span class="text-muted"><%= strip_tags(report.summarize_content).gsub(/[\n]/,"").strip.truncate(75) %></span>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.clinic_review.present? %>
                      <small><span class="text-muted"><%= strip_tags(report.clinic_review).gsub(/[\n]/,"").strip.truncate(75) %></span>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.reasons_for_choosing_this_clinic.present? %>
                      <small><span class="text-muted"><%= strip_tags(report.reasons_for_choosing_this_clinic).gsub(/[\n]/,"").strip.truncate(75) %></span>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.reason_for_transfer.present? %>
                      <small><span class="text-muted"><%= strip_tags(report.reason_for_transfer).gsub(/[\n]/,"").strip.truncate(75) %></span>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.explanation_of_costs.present? %>
                      <small><span class="text-muted"><%= strip_tags(report.explanation_of_costs).gsub(/[\n]/,"").strip.truncate(75) %></span>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% else %>
                      <small>&nbsp;&nbsp;.........&nbsp;&nbsp;<span class="font-weight-bold"><%= report.user.name.strip.truncate(30) %>さんのレポコを読む</span>&nbsp;&nbsp;<%= image_tag"home/finger_mom_up.svg", width: "19px", class: "m-0 p-0", loading: "lazy" %></small>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        <div class="col-3 col-sm-2 px-0">
          <% score = [report.doctor_quality.to_f, report.staff_quality.to_f, report.impression_of_technology.to_f, report.impression_of_price.to_f, report.average_waiting_time2.to_f, report.comfort_of_space.to_f].compact.sum / 6 %>
          <% other = 5 - score %>
          <div class="personalScoreCirleChart_area">
            <canvas id="personalScoreCirleChart_<%= num %>" width="180px;" height="70px;"></canvas>
            <p class="text-dark">
              <% if score != 0 %>
                <%= score %>
              <% else %>
                <small><span class="small text-muted">なし</span></small>
              <% end %>
            </p>
          </div>
          <script>
            var ctx = document.getElementById("personalScoreCirleChart_<%= num %>");
            var myPieChart = new Chart(ctx, {
              type: 'doughnut',
              data: {
                datasets: [{
                    backgroundColor: [
                        "#2DCFC0",
                        "#f0f0f0"
                    ],
                    data: [<%= score %>, <%= other %>],
                }]
              },
              options: {
                cutoutPercentage: 70,
                maintainAspectRatio: false,
                tooltips: false,
              }
            });
          </script>
        </div>
        <div class="d-block d-sm-none">
          <div class="col-12">
            <details class="mt-2 text-dark font-weight-bold">
              <summary class="pl-3">レポコ概要</summary>
              <div class="mt-3 rounded-lg bg-fem p-3">
                <div class="d-flex align-items-start pl-1 pb-3">
                  <div>
                    <%= link_to image_tag("home/user.svg", class: "img-fluid mr-1", loading: "lazy", width: "30px;"), user_path(report.user_id), data: { "turbolinks" => false } %>
                  </div>
                  <div>
                    <% if report.treatment_end_age.present? %>
                      <%= link_to "##{report.str_treatment_end_age}", "/age/#{report.treatment_end_age}", class: "badge badge-pill badge-light text-dark mr-1" %>
                    <% end %>
                    <% if report.prefecture_at_the_time_status == "hide" %>
                      <span class="small text-muted mr-1">−−</span>
                    <% else %>
                      <%= link_to "##{report.city.prefecture.name}", "/users_/#{report.city.prefecture.name_alphabet}", class: "badge badge-pill badge-light mr-1 text-dark" %>
                    <% end %>
                    <% if report.city_at_the_time_status == "hide" %>
                      <span class="small text-muted">−−</span>
                    <% else %>
                      <%= link_to "##{report.city.name}", "/users_/#{report.city.prefecture.name_alphabet}/#{report.city.name_alphabet}", class: "badge badge-pill badge-light text-dark" %>
                    <% end %>
                  </div>
                </div>
                <div class="d-flex align-items-start pl-1 pb-3">
                  <div>
                    <%= link_to image_tag("home/hospital.svg", class: "img-fluid mr-1", loading: "lazy", width: "30px;" ), "/clinic/#{report.clinic.id}" %>
                  </div>
                  <div class="pt-1">
                    <div class="mb-2">
                      <%= link_to "# #{report.clinic.name}", "/clinic/#{report.clinic.id}", class: "ml-1 small" %>
                    </div>
                    <div>
                      <%= link_to "##{report.clinic.city.prefecture.name}", "/clinics_/#{report.clinic.city.prefecture.name_alphabet}", class:"badge badge-pill badge-light text-dark mr-1" %>
                      <%= link_to "##{report.clinic.city.name}", "/clinics/#{report.clinic.city.prefecture.name_alphabet}/#{report.clinic.city.name_alphabet}", class:"badge badge-pill badge-light text-dark" %>
                    </div>
                  </div>
                </div>
                <%= link_to report, data: { "turbolinks" => false } do %>
                  <% if report.title.present? %>
                    <div class="pt-2 pb-1 px-1">
                      <h6><%= strip_tags(report.title.to_s).gsub(/[\n]/,"").strip.truncate(40) %></h6>
                    </div>
                  <% end %>
                  <div  class="d-block d-sm-none lead-content p-2">
                    <% if report.content.present? %>
                      <small><%= strip_tags(report.summarize_content).gsub(/[\n]/,"").strip.truncate(63) %>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.clinic_review.present? %>
                      <small><%= strip_tags(report.clinic_review).gsub(/[\n]/,"").strip.truncate(63) %>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.reasons_for_choosing_this_clinic.present? %>
                      <small><%= strip_tags(report.reasons_for_choosing_this_clinic).gsub(/[\n]/,"").strip.truncate(63) %>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.reason_for_transfer.present? %>
                      <small><%= strip_tags(report.reason_for_transfer).gsub(/[\n]/,"").strip.truncate(63) %>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% elsif report.explanation_of_costs.present? %>
                      <small><%= strip_tags(report.explanation_of_costs).gsub(/[\n]/,"").strip.truncate(63) %>&nbsp;&nbsp;&nbsp;…&nbsp;<span class="font-weight-bold">続きを読む</span></small>
                    <% else %>
                      <small>&nbsp;&nbsp;.........&nbsp;&nbsp;<span class="font-weight-bold"><%= report.user.name.strip.truncate(30) %>さんのレポコを読む</span>&nbsp;&nbsp;<%= image_tag"home/finger_mom_up.svg", width: "19px", class: "m-0 p-0", loading: "lazy" %></small>
                    <% end %>
                  </div>
                <% end %>
              </div>
            </details>
          </div>
        </div>
      </div>
    </div>
  </div>
  <hr class="mb-5">
<% end %>
